!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(n){t(n,window,document)}):t(jQuery,window,document)}(function(t,n,e,i){"use strict";function s(n,e){this.element=n,this.options=t.extend({},h,e),this._defaults=h,this.ns="."+r+o++,this._name=r,this.init()}var r="countrySelect",o=1,h={defaultCountry:"",defaultStyling:"inside",onlyCountries:[],preferredCountries:["us","gb"]},a={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90},u=!1;t(n).on("load",function(){u=!0}),s.prototype={init:function(){this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners()},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_setInstanceCountryData:function(){var n=this;if(this.options.onlyCountries.length){var e=[];t.each(this.options.onlyCountries,function(t,i){var s=n._getCountryData(i,!0);s&&e.push(s)}),this.countries=e}else this.countries=d},_setPreferredCountries:function(){var n=this;this.preferredCountries=[],t.each(this.options.preferredCountries,function(t,e){var i=n._getCountryData(e,!1);i&&n.preferredCountries.push(i)})},_generateMarkup:function(){this.countryInput=t(this.element);var n="country-select";this.options.defaultStyling&&(n+=" "+this.options.defaultStyling),this.countryInput.wrap(t("<div>",{class:n}));var e=t("<div>",{class:"flag-dropdown"}).insertAfter(this.countryInput),i=t("<div>",{class:"selected-flag"}).appendTo(e);this.selectedFlagInner=t("<div>",{class:"flag"}).appendTo(i),t("<div>",{class:"arrow"}).appendTo(this.selectedFlagInner),this.countryList=t("<ul>",{class:"country-list v-hide"}).appendTo(e),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),t("<li>",{class:"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.countryCodeInput=t("#"+this.countryInput.attr("id")+"_code"),this.countryCodeInput||(this.countryCodeInput=t('<input type="hidden" id="'+this.countryInput.attr("id")+'_code" name="'+this.countryInput.attr("name")+'_code" value="" />'),this.countryCodeInput.insertAfter(this.countryInput)),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(n,e){var i="";t.each(n,function(t,n){i+='<li class="country '+e+'" data-country-code="'+n.iso2+'">',i+='<div class="flag '+n.iso2+'"></div>',i+='<span class="country-name">'+n.name+"</span>",i+="</li>"}),this.countryList.append(i)},_setInitialState:function(){var t=!1;this.countryInput.val()&&(t=this._updateFlagFromInputVal());var n=this.countryCodeInput.val();if(n&&this.selectCountry(n),!t){var e;this.options.defaultCountry?(e=this._getCountryData(this.options.defaultCountry,!1))||(e=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0]):e=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this.selectCountry(e.iso2)}},_initListeners:function(){var t=this;this.countryInput.on("keyup"+this.ns,function(){t._updateFlagFromInputVal()});this.selectedFlagInner.parent().on("click"+this.ns,function(n){t.countryList.hasClass("hide")&&!t.countryInput.prop("disabled")&&t._showDropdown()}),this.countryInput.on("blur"+this.ns,function(){t.countryInput.val()!=t.getSelectedCountryData().name&&t.setCountry(t.countryInput.val()),t.countryInput.val(t.getSelectedCountryData().name)})},_focus:function(){this.countryInput.focus();var t=this.countryInput[0];if(t.setSelectionRange){var n=this.countryInput.val().length;t.setSelectionRange(n,n)}},_showDropdown:function(){this._setDropdownPosition();var t=this.countryList.children(".active");this._highlightListItem(t),this.countryList.removeClass("hide"),this._scrollTo(t),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var e=this.countryInput.offset().top,i=t(n).scrollTop(),s=e+this.countryInput.outerHeight()+this.dropdownHeight<i+t(n).height(),r=e-this.dropdownHeight>i,o=!s&&r?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",o)},_bindDropdownListeners:function(){var n=this;this.countryList.on("mouseover"+this.ns,".country",function(e){n._highlightListItem(t(this))}),this.countryList.on("click"+this.ns,".country",function(e){n._selectListItem(t(this))});var i=!0;t("html").on("click"+this.ns,function(t){i||n._closeDropdown(),i=!1}),t(e).on("keydown"+this.ns,function(t){t.preventDefault(),t.which==a.UP||t.which==a.DOWN?n._handleUpDownKey(t.which):t.which==a.ENTER?n._handleEnterKey():t.which==a.ESC?n._closeDropdown():t.which>=a.A&&t.which<=a.Z&&n._handleLetterKey(t.which)})},_handleUpDownKey:function(t){var n=this.countryList.children(".highlight").first(),e=t==a.UP?n.prev():n.next();e.length&&(e.hasClass("divider")&&(e=t==a.UP?e.prev():e.next()),this._highlightListItem(e),this._scrollTo(e))},_handleEnterKey:function(){var t=this.countryList.children(".highlight").first();t.length&&this._selectListItem(t)},_handleLetterKey:function(n){var e=String.fromCharCode(n),i=this.countryListItems.filter(function(){return t(this).text().charAt(0)==e&&!t(this).hasClass("preferred")});if(i.length){var s,r=i.filter(".highlight").first();s=r&&r.next()&&r.next().text().charAt(0)==e?r.next():i.first(),this._highlightListItem(s),this._scrollTo(s)}},_updateFlagFromInputVal:function(){var n=this,e=this.countryInput.val().replace(/(?=[() ])/g,"\\");if(e){for(var i=[],s=new RegExp("^"+e,"i"),r=0;r<this.countries.length;r++)this.countries[r].name.match(s)&&i.push(this.countries[r].iso2);var o=!1;return t.each(i,function(t,e){n.selectedFlagInner.hasClass(e)&&(o=!0)}),o||(this._selectFlag(i[0]),this.countryCodeInput.val(i[0]).trigger("change")),!0}return!1},_highlightListItem:function(t){this.countryListItems.removeClass("highlight"),t.addClass("highlight")},_getCountryData:function(t,n){for(var e=n?d:this.countries,i=0;i<e.length;i++)if(e[i].iso2==t)return e[i];return null},_selectFlag:function(t){if(!t)return!1;this.selectedFlagInner.attr("class","flag "+t);var n=this._getCountryData(t);this.selectedFlagInner.parent().attr("title",n.name);var e=this.countryListItems.children(".flag."+t).first().parent();this.countryListItems.removeClass("active"),e.addClass("active")},_selectListItem:function(t){var n=t.attr("data-country-code");this._selectFlag(n),this._closeDropdown(),this._updateName(n),this.countryInput.trigger("change"),this.countryCodeInput.trigger("change"),this._focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),t(e).off("keydown"+this.ns),t("html").off("click"+this.ns),this.countryList.off(this.ns)},_scrollTo:function(t){if(t&&t.offset()){var n=this.countryList,e=n.height(),i=n.offset().top,s=i+e,r=t.outerHeight(),o=t.offset().top,h=o+r,a=o-i+n.scrollTop();if(o<i)n.scrollTop(a);else if(h>s){var u=e-r;n.scrollTop(a-u)}}},_updateName:function(t){this.countryCodeInput.val(t).trigger("change"),this.countryInput.val(this._getCountryData(t).name)},getSelectedCountryData:function(){var t=this.selectedFlagInner.attr("class").split(" ")[1];return this._getCountryData(t)},selectCountry:function(t){t=t.toLowerCase(),this.selectedFlagInner.hasClass(t)||(this._selectFlag(t),this._updateName(t))},setCountry:function(t){this.countryInput.val(t),this._updateFlagFromInputVal()},destroy:function(){this.countryInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns);this.countryInput.parent().before(this.countryInput).remove()}},t.fn[r]=function(n){var e=arguments;if(n===i||"object"==typeof n)return this.each(function(){t.data(this,"plugin_"+r)||t.data(this,"plugin_"+r,new s(this,n))});if("string"==typeof n&&"_"!==n[0]&&"init"!==n){var o;return this.each(function(){var i=t.data(this,"plugin_"+r);i instanceof s&&"function"==typeof i[n]&&(o=i[n].apply(i,Array.prototype.slice.call(e,1))),"destroy"===n&&t.data(this,"plugin_"+r,null)}),o!==i?o:this}},t.fn[r].getCountryData=function(){return d},t.fn[r].setCountryData=function(t){d=t};var c=0,l=[],d=t.each(uwp_country_data,function(t,n){l[c]={name:n,iso2:t},c++});d=l});
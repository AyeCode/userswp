!function(t){"use strict";window.UWP=window.UWP||{},UWP.Admin={mediaFrames:[],init:function(){this.initColorPicker(),this.initImageUploader(),this.initFormHandlers(),this.initMiscHandlers(),this.initTooltips(),this.initFormControls()},buttonStatus:function(t,e){"loading"===e?(t.data("text",t.html()),t.prop("disabled",!0),t.html('<i class="fas fa-circle-notch fa-spin ml-2"></i> <span>Loading...</span>')):(t.prop("disabled",!1),t.html(t.data("text")))},initColorPicker:function(){let e=t(".uwp-color-picker");e.length&&e.wpColorPicker()},initImageUploader:function(){let e=this;t(".uwp-upload-img").each(function(){let e=t(this),i=e.data("field");t(`[name="${i}[id]"]`).length&&!t(`[name="${i}[id]"]`).val()&&t(".uwp_remove_image_button",e).hide()}),t(document).on("click",".uwp_upload_image_button",function(i){i.preventDefault(),e.handleImageUpload(t(this))}),t(document).on("click",".uwp_remove_image_button",function(){return e.handleImageRemove(t(this)),!1})},handleImageUpload:function(e){let i=e.closest(".uwp-upload-img"),n=i.data("field");if(n){if(this.mediaFrames[n]){this.mediaFrames[n].open();return}this.mediaFrames[n]=wp.media({title:uwp_admin_ajax.txt_choose_image,button:{text:uwp_admin_ajax.txt_use_image},multiple:!1}),this.mediaFrames[n].on("select",(function(){let e=this.mediaFrames[n].state().get("selection").first().toJSON(),o=e.sizes.medium||e.sizes.full;n&&(t(`[name="${n}[id]"]`).val(e.id),t(`[name="${n}[src]"]`).val(e.url),t(`[name="${n}"]`).val(e.id)),i.closest(".form-field.form-invalid").removeClass("form-invalid"),t(".uwp-upload-display",i).find("img").attr("src",o.url),t(".uwp_remove_image_button").show()}).bind(this)),this.mediaFrames[n].open()}},handleImageRemove:function(e){let i=e.closest(".uwp-upload-img"),n=i.data("field");t(".uwp-upload-display",i).find("img").attr("src",uwp_admin_ajax.img_spacer).removeAttr("width height sizes alt class srcset"),n&&(t(`[name="${n}[id]"]`).val(""),t(`[name="${n}[src]"]`).val(""),t(`[name="${n}"]`).val("")),e.hide()},initFormHandlers:function(){let e=this;t(".userswp .forminp .large-text").on({focus:function(){let e=t(this),i=e.attr("placeholder");""===e.val()&&e.val(i)},blur:function(){let e=t(this),i=e.attr("placeholder");e.val()===i&&e.val("")}}),t("#uwp_user_type_form").on("submit",function(i){e.handleRegisterFormSubmit(i,t(this))}),t(document).on("click",".register-form-remove",function(i){e.handleRegisterFormRemove(t(this))})},handleRegisterFormSubmit:function(e,i){e.preventDefault();let{__:n}=wp.i18n,o=this,a=i.find(".alert.alert-danger"),s=i.find(".alert.alert-success"),l=i.find('[name="action"]').val()||"edit",r=i.serialize()+`&action=${"edit"===l?"uwp_ajax_update_register":"uwp_ajax_create_register"}&type=update`,d=t("button[type=submit]",i),c=i.find('[name="form_title"]');if(c.on("input",function(){t(this).hasClass("is-invalid")&&t(this).removeClass("is-invalid")}),""===c.val()){c.addClass("is-invalid"),c.next(".invalid-feedback").text(n("Form title is required.","userswp"));return}c.removeClass("is-invalid"),o.buttonStatus(d,"loading"),t.post(uwp_admin_ajax.url,r,t=>{o.buttonStatus(d,"reset"),!1===t.success?this.handleError(a,s,t.data.message):t.success&&(this.handleSuccess(a,s,t.data.message),t.data.redirect&&setTimeout(()=>{window.location.replace(t.data.redirect)},1e3))},"json").fail(()=>{o.buttonStatus(d,"reset"),o.handleError(a,s,n("There is something that went wrong!","userswp"))})},handleError:function(t,e,i){e.is(":visible")&&e.hide(),t.html(i).slideDown()},handleSuccess:function(t,e,i){t.is(":visible")&&t.hide(),e.html(i).slideDown()},handleRegisterFormRemove:function(e){let i=this,n=e.attr("data-id"),o=e.attr("data-nonce");i.buttonStatus(e,"loading");let a=confirm(uwp_admin_ajax.delete_register_form);a?t.post(uwp_admin_ajax.url,{action:"uwp_ajax_remove_register",type:"remove",form_id:n,nonce:o},function(t){t.status?window.location.replace(t.redirect):console.log(t.message),i.buttonStatus(e,"reset")}):i.buttonStatus(e,"reset")},initMiscHandlers:function(){t(document).on("click",".userswp span code",function(){let e=t(this);t(".userswp span code").removeClass("uwp-tag-copied").find("span").remove(),e.addClass("uwp-tag-copied").append("<span></span>");let i=t("<input>");t("body").append(i),i.val(e.text()).select(),document.execCommand("copy"),i.remove(),setTimeout(function(){t(".userswp span code").removeClass("uwp-tag-copied").find("span").remove()},1e3)}),t("input.uwp-seo-meta-separator").on("change",function(){"checked"===t(this).attr("checked")&&(t("input.uwp-seo-meta-separator").parent().removeClass("active"),t(this).parent().addClass("active"))}).change(),t(".aui-fa-select2").select2({templateResult:this.formatFaSelect,templateSelection:this.formatFaSelection,escapeMarkup:function(t){return t}}),t(document).on("click",".register-show-options",function(){t("#uwp-form-more-options").toggle("fast")})},initFormControls:function(){this.initSectionToggles(),this.initAdvancedSettings()},initSectionToggles:function(){t(document).on("click",".toggle-arrow",e=>{this.handleSectionToggle(t(e.currentTarget))})},initAdvancedSettings:function(){let e=t(".uwp-advanced-toggle"),i=t(".uwp-advanced-setting, #default_location_set_address_button");e.off("click").on("click",function(){e.toggleClass("uwpa-hide"),i.toggleClass("uwpa-show")})},handleSectionToggle:function(e){let i=e.parent(".li-settings"),n=i.find(".field_frm").first(),o=!n.is(":hidden");t(".field_frm").hide(),t(".toggle-arrow").addClass("fa-caret-down").removeClass("fa-caret-up"),o?(e.addClass("fa-caret-down").removeClass("fa-caret-up"),n.hide().removeClass("uwp-tab-settings-open")):(e.addClass("fa-caret-up").removeClass("fa-caret-down"),n.show().addClass("uwp-tab-settings-open"))},handleRadioVisibility:function(e,i,n){setTimeout(()=>{let i=t(e),o=i.closest(".li-settings").find("."+n);i.is(":checked"),o.toggle("fast")},100)},formatFaSelect:function(e){if(!e.id)return e.text;let i=t(e.element).attr("data-fa-icon");return'<i class="fa-lg '+i+'"></i>  '+e.text},formatFaSelection:function(e){if(e.id.length>0){let i=t(e.element).attr("data-fa-icon");return"<i class='fa-lg "+i+"'></i>  "+e.text}return e.text},initTooltips:function(){let e=t(".uwp-help-tip").tooltip(),i=this.getTooltipVersion()>=4?"dispose":"destroy";e.tooltip(i).tooltip({content:function(){return t(this).prop("title")},tooltipClass:"uwp-ui-tooltip",position:{my:"center top",at:"center bottom+10",collision:"flipfit"},show:null,close:function(e,i){i.tooltip.hover(function(){t(this).stop(!0).fadeTo(400,1)},function(){t(this).fadeOut("400",function(){t(this).remove()})})}})},getTooltipVersion:function(){let e=0;return"object"==typeof t.fn&&"function"==typeof t.fn.tooltip&&"function"==typeof t.fn.tooltip.Constructor&&void 0!==t.fn.tooltip.Constructor.VERSION&&(e=parseFloat(t.fn.tooltip.Constructor.VERSION)),e}},window.uwp_show_hide=function(e){UWP.Admin.handleSectionToggle(t(e))},window.uwp_show_hide_radio=function(t,e,i){UWP.Admin.handleRadioVisibility(t,e,i)},window.uwp_init_advanced_settings=function(){UWP.Admin.initAdvancedSettings()},window.uwp_init_tooltips=function(){UWP.Admin.initTooltips()},window.uwp_tooltip_version=function(){return UWP.Admin.getTooltipVersion()},t(document).ready(function(){UWP.Admin.init()})}(jQuery);
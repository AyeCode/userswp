!function(e){"use strict";window.UWP=window.UWP||{},UWP.Form_Builder={actionMap:{register:"uwp_ajax_register_action",profile_tabs:"uwp_ajax_profile_tabs_action",profile_tab:"uwp_ajax_profile_tabs_action",user_sorting:"uwp_ajax_user_sorting_action"},init:function(){this.initFieldAddition(),this.initFieldSorting()},initFieldAddition:function(){const t=this;e("#uwp-form-builder-tab-existing, #uwp-form-builder-tab, #uwp-form-builder-tab-predefined, #uwp-form-builder-tab-custom").find("ul li a").on("click",(i=>{i.preventDefault();const a=e(i.currentTarget);if(!a.attr("id"))return;let n=a.attr("id").replace("uwp-","");const d=a.data("field-type"),r=a.data("field-type-key"),l=a.closest("#uwp-form-builder-tab, #uwp-form-builder-tab-predefined").find("#form_type").val(),o="new"+e(".field_row_main ul.core").children("li:last-child").index()+1,s=a.closest("#uwp-available-fields").find(".manage_field_type").val();let _={htmlvar_name:n,field_type:d,field_type_key:r,form_type:l,field_id:o,field_ins_upd:"new",manage_field_type:s,field_data_type:a.data("data_type"),custom_type:a.data("field-custom-type"),form_id:e('[name="manage_field_form_id"]').val(),_wpnonce:e('[name="_wpnonce"]').val()};"profile_tabs"===s?_={..._,tab_layout:a.data("tab_layout"),tab_level:a.data("tab_level"),tab_parent:a.data("tab_parent"),tab_name:a.data("tab_name"),tab_type:a.data("tab_type"),tab_icon:a.data("tab_icon"),tab_key:a.data("tab_key"),tab_content:a.data("tab_content"),tab_privacy:a.data("tab_privacy"),user_decided:a.data("user_decided")}:"user_sorting"===s&&(_={..._,data_type:a.data("data_type"),tab_level:a.data("tab_level"),tab_parent:a.data("tab_parent"),field_icon:a.data("field_icon"),site_title:a.data("site_title"),sort:a.data("sort")});const u=t.getActionType(s).action;t.addNewField(a,u,_,n,s)}))},getActionType:function(t){if(this.actionMap[t])return{fieldType:t,action:this.actionMap[t]};var i=e.Event("uwp_resolve_form_builder_action");return i.fieldType=t,i.manageFieldType="custom_fields",i.actionType="uwp_ajax_action",e(document).trigger(i),{fieldType:i.manageFieldType,action:i.actionType}},addNewField:function(t,i,a,n,d){e(window).trigger("uwp_form_builder_before_add_field",[n,a]),e.get(uwp_admin_ajax.url+"?action="+i+"&create_field=true",a,(function(t){e(".field_row_main ul.core").append(t),e(`#licontainer_${n}`).find("#sort_order").val(parseInt(e(`#licontainer_${n}`).index())+1);let i=e(`#licontainer_${n}`);i.length||(i=e(`#licontainer_${a.field_id}`)),i.length&&("register"!==d&&UWP.Form_Builder.initTabSettings(i.find(".uwp-fieldset")),e("html, body").animate({scrollTop:i.offset().top},1e3)),"register"===d&&UWP.Form_Builder.saveField(n,"register"),e(window).trigger("uwp_form_builder_after_add_field",[d,n,a])})),e("#uwp-form-builder-tab-existing #uwp-"+n).length>0&&e("#uwp-form-builder-tab-existing #uwp-"+n).closest("li").hide(),"fieldset"===n||"register"!==d&&"search"!==d||t.closest("li").hide()},initFieldSorting:function(){e("ul.uwp-tabs-selected").sortable({opacity:.8,cursor:"move",placeholder:"ui-state-highlight",cancel:"input,label,select",update:function(){UWP.Form_Builder.updateFieldOrder(e(this)),console.log("Fields have been ordered."),aui_toast("uwp_tabs_reorder_tab_success","success",uwp_admin_ajax.txt_saved)}}),e("ul.uwp-profile-tabs-selected").nestedSortable({maxLevels:2,handle:".uwp-fieldset",items:"li",disableNestingClass:"mjs-nestedSortable-no-nesting",helper:"clone",placeholder:"ui-state-highlight",forcePlaceholderSize:!0,listType:"ul",update:function(){UWP.Form_Builder.updateTabOrder(e(this))}})},updateFieldOrder:function(t){const i=t.closest("#uwp-selected-fields").find(".manage_field_type").val(),a=t.sortable("serialize")+"&update=update&manage_field_type="+i,n="&form_id="+e('[name="manage_field_form_id"]').val(),d=UWP.Form_Builder.getActionType(i).action;e.get(uwp_admin_ajax.url+"?action="+d+"&create_field=true",a+n,(function(){}))},updateTabOrder:function(t){const i=t.closest("#uwp-selected-fields").find(".manage_field_type").val(),a=e(".field_row_main ul.core").nestedSortable("toArray",{startDepthCount:0}),n={},d=e('[name="manage_field_form_id"]').val();e.each(a,(function(e,t){t.id&&(n[e]={id:t.id,tab_level:t.depth,tab_parent:t.parent_id})}));const r=UWP.Form_Builder.getActionType(i).action,l={tabs:n,form_id:d,_wpnonce:e('[name="_wpnonce"]').val()};e.get(uwp_admin_ajax.url+"?action="+r+"&create_field=true&update=update&manage_field_type="+i,l,(function(){}))},saveField:function(t,i){const a="&form_id="+e('[name="manage_field_form_id"]').val(),n=UWP.Form_Builder.getActionType(i),d=n.action,r=n.fieldType;if(e(".uwp-form-settings-form #htmlvar_name").length>0){const t=e(".uwp-form-settings-form  #htmlvar_name").val();if(""!==t){const e="!`@#$%^&*()+=-[]\\';,./{}|\":<>?~ ";for(let i=0;i<t.length;i++)if(-1!==e.indexOf(t.charAt(i)))return alert(uwp_admin_ajax.custom_field_not_special_char),!1}const i=e(".uwp-form-settings-form #option_values");if(1===i.length&&""===i.val())return alert(uwp_admin_ajax.custom_field_options_not_blank_var),!1}const l="register"===i?e(`#licontainer_${t} form`).serializeObject():e(".uwp-form-settings-form").serializeObject();l.create_field=!0,l.field_ins_upd="submit",e.post({url:`${uwp_admin_ajax.url}?action=${d}&manage_field_type=${r}${a}`,data:l,beforeSend:function(){e(".uwp-form-settings-form #save").html('<span class="spinner-border spinner-border-sm" role="status"></span> '+uwp_admin_ajax.txt_saving).addClass("disabled")},success:function(a){"invalid_key"===e.trim(a)?(e(".uwp-form-settings-form #save").html(uwp_admin_ajax.txt_save).removeClass("disabled"),alert(uwp_admin_ajax.custom_field_unique_name)):(e(`#licontainer_${t}`).replaceWith(e.trim(a)),aui_toast("uwp_tabs_save_tab_success","success",uwp_admin_ajax.txt_saved),"profile_tab"===i?UWP.Form_Builder.updateTabOrder(e(".field_row_main ul.core")):UWP.Form_Builder.updateFieldOrder(e(".field_row_main ul.core")),UWP.Form_Builder.closeTabSettings(),aui_init())}})},deleteField:function(t,i,a,n){const d=e('[name="manage_field_form_id"]').val(),r=UWP.Form_Builder.getActionType(n);aui_confirm(uwp_admin_ajax.custom_field_delete,uwp_admin_ajax.txt_delete,uwp_admin_ajax.txt_cancel,!0).then((function(n){n&&("new"===t.substring(0,3)?e(`#licontainer_${t}`).remove():(e.get(`${uwp_admin_ajax.url}`,{action:r.action,create_field:!0,field_ins_upd:"delete",manage_field_type:r.fieldType,field_id:t,form_id:d,_wpnonce:i},(function(){e(`#licontainer_${t}`).remove()})),e(`#uwp-${a}`).closest("li").show()),aui_toast("uwp_tabs_delete_success","success",uwp_admin_ajax.txt_deleted),e("#uwp-field-settings:visible button.btn-close").length&&e("#uwp-field-settings:visible button.btn-close").trigger("click"),e(`#uwp-form-builder-tab-existing #uwp-${a}`).length>0&&e(`#uwp-form-builder-tab-existing #uwp-${a}`).closest("li").hide())}))},initTabSettings:function(t){e("#licontainer_").length&&"licontainer_"!=e(t).parent().attr("id")?e("#licontainer_").remove():e("#licontainer_new-1").length&&"licontainer_new-1"!=e(t).parent().attr("id")&&e("#licontainer_new-1").remove();let i=e(t).parent().find(".dd-setting").first().html();i=jQuery('<div class="dd-setting">'+i+"</div>"),i.removeClass("d-none");const a=i.find('[name="id"]').val(),n=i.find('[name="tab_type"]').val();e(t).closest("ul").hasClass("dd-list")||"fieldset"==n?i.find(".alert-info").addClass("d-none"):i.find(`[data-argument="gd-tab-name-${a}"],[data-argument="gd-tab-icon-${a}"]`).addClass("d-none"),e("#uwp-form-builder-tab-selected .dd-form").removeClass("border-width-2 border-primary"),e(t).parent().find(".dd-form").first().addClass("border-width-2 border-primary"),e("#uwp-field-settings .card-body").html(i),e("#uwp-field-settings .card-body").find(".iconpicker-input").removeClass("iconpicker-input"),e("#uwp-field-settings-tab").tab("show"),e("#uwp-field-settings .card-footer").html(""),e("#uwp-field-settings .uwp-tab-actions").detach().appendTo("#uwp-field-settings .card-footer"),UWP.Admin.initAdvancedSettings(),aui_init(),e(".uwp-form-settings-form").off("change").on("change",(function(){try{aui_conditional_fields(".uwp-form-settings-form")}catch(e){console.log(e.message)}}));try{aui_conditional_fields(".uwp-form-settings-form")}catch(e){console.log(e.message)}},closeTabSettings:function(){e("#uwp-fields-tab").tab("show"),e("#uwp-selected-fields .dd-form").removeClass("border-width-2 border-primary");const t=e("#uwp-field-settings").find('[name="id"],[name="field_id"]').val();t&&e.isNumeric(t)||e(`#licontainer_,#licontainer_${t}`).remove()},dataTypeChanged:function(t,i){t&&i&&(e(`#licontainer_${i}`).find(".decimal-point-wrapper").hide(),"FLOAT"==e(t).val()&&e(`#licontainer_${i}`).find(".decimal-point-wrapper").show(),"FLOAT"==e(t).val()||"INT"==e(t).val()?(e(`#licontainer_${i}`).find(".uwp-price-extra-set").show(),"1"==e(`#licontainer_${i}`).find(".uwp-price-extra-set input[name='extra[is_price]']:checked").val()&&e(`#licontainer_${i}`).find(".uwp-price-extra").show()):(e(`#licontainer_${i}`).find(".uwp-price-extra-set").hide(),e(`#licontainer_${i}`).find(".uwp-price-extra").hide()))}},window.uwp_data_type_changed=UWP.Form_Builder.dataTypeChanged,window.save_field=UWP.Form_Builder.saveField,window.delete_field=UWP.Form_Builder.deleteField,window.uwp_tabs_close_settings=UWP.Form_Builder.closeTabSettings,window.uwp_tabs_item_settings=UWP.Form_Builder.initTabSettings,e(document).ready((function(){UWP.Form_Builder.init()})),e.fn.serializeObject=function(){var t={},i=this.serializeArray();return e.each(i,(function(){t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""})),t}}(jQuery);